<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºæ…§èƒ½æºç®¡ç†å¤§å±</title>
    <style>
        /* å…¨å±€æ ·å¼ */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Microsoft YaHei', 'Segoe UI', Arial, sans-serif;
    background-color: #f0f2f5;
    color: #333;
    line-height: 1.6;
}

/* ç™»å½•é¡µé¢æ ·å¼ */
.login-container {
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.login-box {
    background: white;
    padding: 40px;
    border-radius: 10px;
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
    width: 100%;
    max-width: 400px;
}

.login-box h1 {
    color: #333;
    text-align: center;
    margin-bottom: 10px;
    font-size: 24px;
}

.login-box h2 {
    color: #666;
    text-align: center;
    margin-bottom: 30px;
    font-size: 18px;
    font-weight: normal;
}

.form-group {
    margin-bottom: 20px;
}

.form-group label {
    display: block;
    margin-bottom: 8px;
    color: #555;
    font-weight: 500;
}

.form-group input {
    width: 100%;
    padding: 12px;
    border: 1px solid #ddd;
    border-radius: 5px;
    font-size: 16px;
    transition: border-color 0.3s;
}

.form-group input:focus {
    border-color: #667eea;
    outline: none;
    box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.2);
}

.btn-login {
    width: 100%;
    padding: 14px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    border-radius: 5px;
    font-size: 16px;
    font-weight: bold;
    cursor: pointer;
    transition: transform 0.2s;
}

.btn-login:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
}

.error-message {
    background-color: #fee;
    color: #c33;
    padding: 10px;
    border-radius: 5px;
    margin-bottom: 20px;
    border-left: 4px solid #c33;
}

.login-note {
    margin-top: 20px;
    padding: 15px;
    background-color: #f8f9fa;
    border-radius: 5px;
    text-align: center;
    color: #666;
}

/* å¤§å±é¡µé¢æ ·å¼ */
.dashboard-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 20px;
}

.header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 30px;
    padding-bottom: 20px;
    border-bottom: 2px solid #e0e0e0;
}

.header-left h1 {
    color: #333;
    font-size: 28px;
    margin-bottom: 5px;
}

.welcome {
    color: #666;
    font-size: 16px;
}

.header-right {
    display: flex;
    align-items: center;
    gap: 20px;
}

.current-time {
    background-color: #333;
    color: white;
    padding: 8px 15px;
    border-radius: 5px;
    font-family: monospace;
}

.btn-logout {
    padding: 10px 20px;
    background-color: #dc3545;
    color: white;
    text-decoration: none;
    border-radius: 5px;
    font-weight: bold;
    transition: background-color 0.3s;
}

.btn-logout:hover {
    background-color: #c82333;
}

.config-info {
    background-color: #e8f4fd;
    border-left: 4px solid #2196F3;
    padding: 15px;
    margin-bottom: 20px;
    border-radius: 5px;
}

.config-info h2 {
    color: #2196F3;
    margin-bottom: 10px;
}

.dashboard-content {
    background: white;
    padding: 30px;
    border-radius: 10px;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    margin-bottom: 30px;
}

.dashboard-content h2 {
    color: #333;
    margin-bottom: 20px;
    padding-bottom: 10px;
    border-bottom: 2px solid #f0f0f0;
}

.data-time {
    color: #666;
    font-style: italic;
    margin-bottom: 30px;
}

.data-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-bottom: 40px;
}

.data-card {
    background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
    padding: 20px;
    border-radius: 10px;
    text-align: center;
    transition: transform 0.3s;
}

.data-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
}

.data-card h3 {
    color: #555;
    margin-bottom: 15px;
    font-size: 18px;
}

.data-value {
    font-size: 28px;
    font-weight: bold;
    color: #333;
}

.alarm-section {
    margin-top: 40px;
}

.alarm-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
}

.alarm-card {
    padding: 20px;
    border-radius: 10px;
    text-align: center;
    color: white;
}

.alarm-card.high {
    background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%);
}

.alarm-card.medium {
    background: linear-gradient(135deg, #ffb347 0%, #ffcc33 100%);
}

.alarm-card.low {
    background: linear-gradient(135deg, #36D1DC 0%, #5B86E5 100%);
}

.alarm-card.total {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.alarm-card h3 {
    margin-bottom: 10px;
    font-size: 16px;
}

.alarm-value {
    font-size: 32px;
    font-weight: bold;
}

.display-fields {
    background-color: #f9f9f9;
    padding: 15px;
    border-radius: 5px;
    margin-top: 30px;
    border-left: 4px solid #4CAF50;
}

.footer {
    text-align: center;
    padding: 20px;
    color: #666;
    border-top: 1px solid #e0e0e0;
    margin-top: 30px;
}

/* å“åº”å¼è®¾è®¡ */
@media (max-width: 768px) {
    .dashboard-container {
        padding: 10px;
    }

    .header {
        flex-direction: column;
        text-align: center;
        gap: 15px;
    }

    .header-right {
        flex-direction: column;
        gap: 10px;
    }

    .data-grid {
        grid-template-columns: 1fr;
    }

    .alarm-grid {
        grid-template-columns: 1fr;
    }
}

/* é«˜ç­‰çº§å‘Šè­¦æ¨é€æ ·å¼ */
.alarm-push-section {
    background: white;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    margin-top: 30px;
}

.alarm-push-section h2 {
    color: #333;
    margin-bottom: 20px;
    padding-bottom: 10px;
    border-bottom: 2px solid #f0f0f0;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.pending-badge {
    background-color: #ff9800;
    color: white;
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 14px;
    font-weight: normal;
}

.alarm-list {
    max-height: 400px;
    overflow-y: auto;
}

.alarm-item {
    border-left: 4px solid;
    padding: 15px;
    margin-bottom: 15px;
    background-color: #fff;
    border-radius: 5px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
}

/* å¾…å†³ç­–å‘Šè­¦æ ·å¼ */
.alarm-pending {
    border-left-color: #ff9800;
    background-color: #fff3e0;
    animation: blink-pending 2s infinite;
}

@keyframes blink-pending {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.8; }
}

/* æœªå¤„ç†å‘Šè­¦æ ·å¼ */
.alarm-unhandled {
    border-left-color: #f44336;
    background-color: #ffebee;
}

/* å¤„ç†ä¸­å‘Šè­¦æ ·å¼ */
.alarm-processing {
    border-left-color: #ffc107;
    background-color: #fff9e6;
}

/* å·²ç»“æ¡ˆå‘Šè­¦æ ·å¼ */
.alarm-handled {
    border-left-color: #28a745;
    background-color: #f0fff4;
}

.alarm-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
    font-size: 14px;
}

.alarm-time {
    color: #666;
    font-family: monospace;
}

.alarm-type {
    background-color: #e9ecef;
    padding: 2px 8px;
    border-radius: 3px;
    color: #495057;
}

.alarm-status {
    font-weight: bold;
}

.alarm-pending .alarm-status {
    color: #ff9800;
}

.alarm-unhandled .alarm-status {
    color: #f44336;
}

.alarm-processing .alarm-status {
    color: #ffc107;
}

.alarm-handled .alarm-status {
    color: #28a745;
}

.alarm-content {
    font-size: 16px;
    margin-bottom: 8px;
    color: #333;
}

.alarm-device {
    font-size: 14px;
    color: #666;
    background-color: #f8f9fa;
    padding: 5px 10px;
    border-radius: 3px;
    display: inline-block;
}

.no-alarms {
    text-align: center;
    padding: 40px;
    color: #28a745;
    background-color: #f0fff4;
    border-radius: 5px;
    border: 2px dashed #28a745;
}

/* æ»šåŠ¨æ¡æ ·å¼ */
.alarm-list::-webkit-scrollbar {
    width: 8px;
}

.alarm-list::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 4px;
}

.alarm-list::-webkit-scrollbar-thumb {
    background: #888;
    border-radius: 4px;
}

.alarm-list::-webkit-scrollbar-thumb:hover {
    background: #555;
}

/* å‘Šè­¦å¤„ç†æŒ‰é’®æ ·å¼ */
.alarm-actions {
    margin-top: 15px;
    display: flex;
    gap: 10px;
}

.btn-confirm, .btn-abandon {
    padding: 8px 16px;
    border: none;
    border-radius: 5px;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s;
    font-size: 14px;
}

.btn-confirm {
    background-color: #4CAF50;
    color: white;
}

.btn-confirm:hover {
    background-color: #45a049;
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(76, 175, 80, 0.3);
}

.btn-abandon {
    background-color: #6c757d;
    color: white;
}

.btn-abandon:hover {
    background-color: #5a6268;
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(108, 117, 125, 0.3);
}

/* å¤„ç†ä¿¡æ¯æ ·å¼ */
.alarm-processing-info {
    margin-top: 15px;
    padding: 10px;
    background-color: #e7f3ff;
    border-radius: 5px;
    color: #0066cc;
    text-align: center;
}

.alarm-unhandled-info {
    margin-top: 15px;
    padding: 10px;
    background-color: #ffebee;
    border-radius: 5px;
    color: #d32f2f;
    text-align: center;
}

/* å“åº”å¼è°ƒæ•´ */
@media (max-width: 768px) {
    .alarm-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 5px;
    }

    .alarm-type, .alarm-status {
        align-self: flex-start;
    }

    .alarm-actions {
        flex-direction: column;
    }
}
/* å…‰ä¼æ”¶ç›Šå¡ç‰‡ç‰¹æ®Šæ ·å¼ */
.revenue-card {
    background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%) !important;
    color: white !important;
}

.revenue-card h3 {
    color: white !important;
}

.revenue-card .data-value {
    color: white !important;
    font-size: 32px !important;
    margin-bottom: 10px;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
}

.revenue-details {
    margin-top: 10px;
    font-size: 12px;
    opacity: 0.9;
    border-top: 1px solid rgba(255, 255, 255, 0.2);
    padding-top: 8px;
}

.revenue-details p {
    margin: 3px 0;
    font-size: 11px;
}
/* æŠ¥å‘ŠæŸ¥çœ‹æŒ‰é’®æ ·å¼ */
.report-section {
    background: white;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    margin-top: 30px;
    text-align: center;
}

.report-section h2 {
    color: #333;
    margin-bottom: 20px;
    text-align: center;
}

.report-buttons {
    display: flex;
    justify-content: center;
    gap: 20px;
    flex-wrap: wrap;
}

.btn-report {
    padding: 12px 24px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    border-radius: 5px;
    font-size: 16px;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s;
    display: flex;
    align-items: center;
    gap: 8px;
}

.btn-report:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
}

/* å“åº”å¼è°ƒæ•´ */
@media (max-width: 768px) {
    .report-buttons {
        flex-direction: column;
    }

    .btn-report {
        width: 100%;
        justify-content: center;
    }
}
    </style>
<!--    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">-->
    <script>
        // è‡ªåŠ¨åˆ·æ–°é¡µé¢ï¼ˆæ ¹æ®é…ç½®çš„åˆ·æ–°é¢‘ç‡ï¼‰
        function autoRefresh() {
            setTimeout(function() {
                location.reload();
            }, 30000); // é»˜è®¤30ç§’åˆ·æ–°ä¸€æ¬¡
        }

        // æ›´æ–°æ—¶é—´æ˜¾ç¤º
        function updateTime() {
            const now = new Date();
            const timeStr = now.toLocaleString('zh-CN');
            document.getElementById('current-time').textContent = timeStr;
        }

        // è‡ªåŠ¨åˆ·æ–°å‘Šè­¦æ•°æ®ï¼ˆå•ç‹¬åˆ·æ–°ï¼Œä¸å½±å“æ•´ä¸ªé¡µé¢ï¼‰
        function refreshAlarms() {
            fetch('/api/management/high-alarms')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // æ›´æ–°å¾…å†³ç­–å‘Šè­¦æ•°é‡
                        const badge = document.querySelector('.pending-badge');
                        if (badge && data.pending_count > 0) {
                            badge.textContent = data.pending_count + ' æ¡å¾…å†³ç­–';
                        } else if (badge && data.pending_count === 0) {
                            badge.style.display = 'none';
                        }

                        // å¦‚æœæœ‰æ–°çš„å¾…å†³ç­–å‘Šè­¦ï¼Œæ˜¾ç¤ºé€šçŸ¥
                        if (data.pending_count > 0) {
                            if ('Notification' in window && Notification.permission === 'granted') {
                                new Notification('âš ï¸ æœ‰æ–°çš„é«˜ç­‰çº§å‘Šè­¦å¾…å†³ç­–', {
                                    body: `æœ‰ ${data.pending_count} æ¡å¾…å†³ç­–çš„é«˜ç­‰çº§å‘Šè­¦`,
                                    icon: '/static/alert.png'
                                });
                            }
                        }
                    }
                })
                .catch(error => console.error('åˆ·æ–°å‘Šè­¦å¤±è´¥:', error));
        }

        // è¯·æ±‚æµè§ˆå™¨é€šçŸ¥æƒé™
        function requestNotificationPermission() {
            if ('Notification' in window) {
                Notification.requestPermission().then(permission => {
                    console.log('é€šçŸ¥æƒé™:', permission);
                });
            }
        }

        // å¤„ç†å‘Šè­¦çš„å‡½æ•°
        function handleAlarm(alarmId, action) {
            const actionText = action === 'repair' ? 'ç¡®è®¤ç»´ä¿®' : 'æ”¾å¼ƒç»´ä¿®';

            if (!confirm(`ç¡®å®šè¦${actionText}å—ï¼Ÿ`)) {
                return;
            }

            fetch('/api/management/handle-alarm', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    alarm_id: alarmId,
                    action: action
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert(data.message);

                    // æ›´æ–°é¡µé¢ä¸Šçš„å‘Šè­¦çŠ¶æ€
                    const alarmElement = document.getElementById(`alarm-${alarmId}`);
                    if (alarmElement) {
                        const statusElement = alarmElement.querySelector('.alarm-status');
                        const actionsElement = alarmElement.querySelector('.alarm-actions');

                        if (statusElement) {
                            statusElement.textContent = data.new_status;
                        }

                        // æ›´æ–°æ ·å¼
                        if (data.new_status === 'æœªå¤„ç†') {
                            alarmElement.className = 'alarm-item alarm-unhandled';
                            // ç§»é™¤æ“ä½œæŒ‰é’®ï¼Œæ˜¾ç¤ºæœªå¤„ç†ä¿¡æ¯
                            if (actionsElement) {
                                actionsElement.innerHTML =
                                    '<div class="alarm-unhandled-info"><p>âš ï¸ å‘Šè­¦å·²ç¡®è®¤ç»´ä¿®ï¼Œç­‰å¾…å¤„ç†</p></div>';
                            }
                        } else if (data.new_status === 'å·²ç»“æ¡ˆ') {
                            alarmElement.className = 'alarm-item alarm-handled';
                            // ç§»é™¤æ“ä½œæŒ‰é’®
                            if (actionsElement) {
                                actionsElement.innerHTML =
                                    '<div class="alarm-processing-info"><p>âœ… å‘Šè­¦å·²æ”¾å¼ƒç»´ä¿®</p></div>';
                            }
                        }
                    }

                    // åˆ·æ–°å‘Šè­¦åˆ—è¡¨
                    refreshAlarms();
                } else {
                    alert('æ“ä½œå¤±è´¥: ' + data.error);
                }
            })
            .catch(error => {
                console.error('å¤„ç†å‘Šè­¦å¤±è´¥:', error);
                alert('ç½‘ç»œé”™è¯¯ï¼Œè¯·é‡è¯•');
            });
        }

        // é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œ
        window.onload = function() {
            autoRefresh();
            updateTime();
            requestNotificationPermission();

            // æ¯30ç§’åˆ·æ–°ä¸€æ¬¡æ—¶é—´
            setInterval(updateTime, 1000);

            // æ¯20ç§’åˆ·æ–°ä¸€æ¬¡å‘Šè­¦æ•°æ®
            setInterval(refreshAlarms, 20000);
        };
    </script>
</head>
<body>
    <div class="dashboard-container">
        <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
        <div class="header">
            <div class="header-left">
                <h1>æ™ºæ…§èƒ½æºç®¡ç†å¤§å±</h1>
                <p class="welcome">æ¬¢è¿æ‚¨ï¼Œ{{ user.çœŸå®å§“å }}ï¼ˆ{{ user.ç”¨æˆ·è§’è‰² }}ï¼‰</p>
            </div>
            <div class="header-right">
                <div class="current-time" id="current-time"></div>
                <a href="{{ url_for('logout') }}" class="btn-logout">é€€å‡ºç™»å½•</a>
            </div>
        </div>

        <!-- é”™è¯¯æç¤º -->
        {% if error %}
        <div class="error-message">{{ error }}</div>
        {% endif %}

        <!-- é…ç½®ä¿¡æ¯ -->
        {% if config %}
        <div class="config-info">
            <h2>å¤§å±é…ç½®ä¿¡æ¯</h2>
            <p>å±•ç¤ºæ¨¡å—ï¼š{{ config.å±•ç¤ºæ¨¡å— }}</p>
            <p>åˆ·æ–°é¢‘ç‡ï¼š{{ config.æ•°æ®åˆ·æ–°é¢‘ç‡ }}</p>
            <p>æ’åºè§„åˆ™ï¼š{{ config.æ’åºè§„åˆ™ }}</p>
        </div>
        {% endif %}

        <!-- ä¸»è¦æ•°æ®æ˜¾ç¤ºåŒºåŸŸ -->
        {% if data %}
        <div class="dashboard-content">
            <h2>èƒ½æºè¿è¡Œæ€»è§ˆ</h2>
            <p class="data-time">æ•°æ®æ—¶é—´ï¼š{{ data.ç»Ÿè®¡æ—¶é—´ }}</p>

            <div class="data-grid">
                <!-- ç”¨ç”µæ•°æ® -->
                <div class="data-card">
                    <h3>ç”¨ç”µæƒ…å†µ</h3>
                    <div class="data-value">{{ data.æ€»ç”¨ç”µé‡|default(0)|float }} kWh</div>
                </div>

                <!-- ç”¨æ°´æ•°æ® -->
                <div class="data-card">
                    <h3>ç”¨æ°´æƒ…å†µ</h3>
                    <div class="data-value">{{ data.æ€»ç”¨æ°´é‡|default(0)|float }} mÂ³</div>
                </div>

                <!-- è’¸æ±½æ•°æ® -->
                <div class="data-card">
                    <h3>è’¸æ±½æ¶ˆè€—</h3>
                    <div class="data-value">{{ data.æ€»è’¸æ±½æ¶ˆè€—é‡|default(0)|float }} t</div>
                </div>

                <!-- å¤©ç„¶æ°”æ•°æ® -->
                <div class="data-card">
                    <h3>å¤©ç„¶æ°”æ¶ˆè€—</h3>
                    <div class="data-value">{{ data.æ€»å¤©ç„¶æ°”æ¶ˆè€—é‡|default(0)|float }} mÂ³</div>
                </div>

                <!-- å…‰ä¼å‘ç”µæ•°æ® -->
                <div class="data-card">
                    <h3>å…‰ä¼æ€»å‘ç”µé‡</h3>
                    <div class="data-value">{{ data.å…‰ä¼æ€»å‘ç”µé‡|default(0)|float }} kWh</div>
                </div>

                <!-- å…‰ä¼è‡ªç”¨ç”µæ•°æ® -->
                <div class="data-card">
                    <h3>å…‰ä¼è‡ªç”¨ç”µé‡</h3>
                    <div class="data-value">{{ data.å…‰ä¼è‡ªç”¨ç”µé‡|default(0)|float }} kWh</div>
                </div>

                <!-- æ–°å¢ï¼šå…‰ä¼æ”¶ç›Š -->
                <div class="data-card revenue-card">
                    <h3>å…‰ä¼æ”¶ç›Š</h3>
                    <div class="data-value">Â¥ {{ data.å…‰ä¼æ”¶ç›Š|default(0)|float }}</div>
                    <div class="revenue-details">
                        <p>è‡ªç”¨ç”µä»·ï¼šÂ¥ {{ data.è‡ªç”¨ç”µä»·|default(0.8)|float }} /kWh</p>
                        <p>ä¸Šç½‘ç”µä»·ï¼šÂ¥ {{ data.ä¸Šç½‘ç”µä»·|default(0.4)|float }} /kWh</p>
                        {% if data.å…‰ä¼å‰©ä½™ä¸Šç½‘ç”µé‡ is defined %}
                        <p>ä¸Šç½‘ç”µé‡ï¼š{{ data.å…‰ä¼å‰©ä½™ä¸Šç½‘ç”µé‡|float }} kWh</p>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- å‘Šè­¦ç»Ÿè®¡ -->
            <div class="alarm-section">
                <h2>å‘Šè­¦ç»Ÿè®¡</h2>
                <div class="alarm-grid">
                    <div class="alarm-card high">
                        <h3>é«˜ç­‰çº§å‘Šè­¦</h3>
                        <div class="alarm-value">{{ data.é«˜ç­‰çº§å‘Šè­¦æ•°|default(0) }}</div>
                    </div>

                    <div class="alarm-card medium">
                        <h3>ä¸­ç­‰çº§å‘Šè­¦</h3>
                        <div class="alarm-value">{{ data.ä¸­ç­‰çº§å‘Šè­¦æ•°|default(0) }}</div>
                    </div>

                    <div class="alarm-card low">
                        <h3>ä½ç­‰çº§å‘Šè­¦</h3>
                        <div class="alarm-value">{{ data.ä½ç­‰çº§å‘Šè­¦æ•°|default(0) }}</div>
                    </div>

                    <div class="alarm-card total">
                        <h3>æ€»å‘Šè­¦æ¬¡æ•°</h3>
                        <div class="alarm-value">{{ data.æ€»å‘Šè­¦æ¬¡æ•°|default(0) }}</div>
                    </div>
                </div>
            </div>

            <!-- é«˜ç­‰çº§å‘Šè­¦æ¨é€åŒºåŸŸï¼ˆè®¾å¤‡æ•…éšœï¼‰ -->
            <div class="alarm-push-section">
                <h2>
                    ğŸ”´ é«˜ç­‰çº§å‘Šè­¦æ¨é€ï¼ˆè®¾å¤‡æ•…éšœï¼‰
                    {% if pending_count > 0 %}
                    <span class="pending-badge">{{ pending_count }} æ¡å¾…å†³ç­–</span>
                    {% endif %}
                </h2>

                {% if high_alarms %}
                <div class="alarm-list">
                    {% for alarm in high_alarms %}
                    <div class="alarm-item
                        {% if alarm.å¤„ç†çŠ¶æ€ == 'å¾…å†³ç­–' %}alarm-pending
                        {% elif alarm.å¤„ç†çŠ¶æ€ == 'å¤„ç†ä¸­' %}alarm-processing
                        {% elif alarm.å¤„ç†çŠ¶æ€ == 'æœªå¤„ç†' %}alarm-unhandled
                        {% else %}alarm-handled{% endif %}"
                        id="alarm-{{ alarm.å‘Šè­¦ID }}">
                        <div class="alarm-header">
                            <span class="alarm-time">{{ alarm.å‘ç”Ÿæ—¶é—´ }}</span>
                            <span class="alarm-type">{{ alarm.å‘Šè­¦ç±»å‹ }}</span>
                            <span class="alarm-status">{{ alarm.å¤„ç†çŠ¶æ€ }}</span>
                        </div>
                        <div class="alarm-content">
                            {{ alarm.å‘Šè­¦å†…å®¹ }}
                        </div>
                        {% if alarm.å…³è”è®¾å¤‡ç¼–å· %}
                        <div class="alarm-device">
                            è®¾å¤‡ç¼–å·ï¼š{{ alarm.å…³è”è®¾å¤‡ç¼–å· }}
                        </div>
                        {% endif %}

                        <!-- å¤„ç†æŒ‰é’®ï¼ˆåªå¯¹å¾…å†³ç­–çš„å‘Šè­¦æ˜¾ç¤ºï¼‰ -->
                        {% if alarm.å¤„ç†çŠ¶æ€ == 'å¾…å†³ç­–' %}
                        <div class="alarm-actions">
                            <button class="btn-confirm" onclick="handleAlarm('{{ alarm.å‘Šè­¦ID }}', 'repair')">
                                âœ… ç¡®è®¤ç»´ä¿®
                            </button>
                            <button class="btn-abandon" onclick="handleAlarm('{{ alarm.å‘Šè­¦ID }}', 'abandon')">
                                âŒ æ”¾å¼ƒç»´ä¿®
                            </button>
                        </div>
                        {% elif alarm.å¤„ç†çŠ¶æ€ == 'å¤„ç†ä¸­' %}
                        <div class="alarm-processing-info">
                            <p>â³ å‘Šè­¦æ­£åœ¨å¤„ç†ä¸­...</p>
                        </div>
                        {% elif alarm.å¤„ç†çŠ¶æ€ == 'æœªå¤„ç†' %}
                        <div class="alarm-unhandled-info">
                            <p>âš ï¸ å‘Šè­¦å·²ç¡®è®¤ç»´ä¿®ï¼Œç­‰å¾…å¤„ç†</p>
                        </div>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="no-alarms">
                    <p>âœ… å½“å‰æ— é«˜ç­‰çº§è®¾å¤‡æ•…éšœå‘Šè­¦</p>
                </div>
                {% endif %}
            </div>

            <!-- æ•°æ®å±•ç¤ºå­—æ®µï¼ˆå¦‚æœé…ç½®ä¸­æœ‰ï¼‰ -->
            {% if config and config.å±•ç¤ºå­—æ®µ %}
            <div class="display-fields">
                <h3>é…ç½®çš„å±•ç¤ºå­—æ®µï¼š</h3>
                <p>{{ config.å±•ç¤ºå­—æ®µ }}</p>
            </div>
            {% endif %}
        </div>
        {% endif %}
        <!-- åœ¨é¡µè„šä¹‹å‰æ·»åŠ æŠ¥å‘ŠæŸ¥çœ‹æŒ‰é’® -->
{% if data %}
<div class="report-section">
    <h2>ğŸ“‹ èƒ½è€—æ€»ç»“æŠ¥å‘Š</h2>
    <div class="report-buttons">
        <button class="btn-report" onclick="openMonthlyReports()">
            ğŸ“… æŸ¥çœ‹æœˆåº¦æ€»ç»“æŠ¥å‘Š
        </button>
        <button class="btn-report" onclick="openQuarterlyReports()">
            ğŸ“Š æŸ¥çœ‹å­£åº¦æ€»ç»“æŠ¥å‘Š
        </button>
    </div>
</div>
{% endif %}

<script>
// åœ¨é¡µé¢æ·»åŠ JavaScriptå‡½æ•°
function openMonthlyReports() {
    window.location.href = '/management/reports/monthly';
}

function openQuarterlyReports() {
    window.location.href = '/management/reports/quarterly';
}
</script>
        <!-- é¡µè„š -->
        <div class="footer">
            <p>æ™ºæ…§èƒ½æºç®¡ç†ç³»ç»Ÿ Â© 2025 åŒ—äº¬æ—ä¸šå¤§å­¦</p>
            <p>æ•°æ®æ›´æ–°æ—¶é—´ï¼š<span id="update-time">{{ data.ç»Ÿè®¡æ—¶é—´ if data else 'æš‚æ— æ•°æ®' }}</span></p>
        </div>
    </div>
</body>
</html>