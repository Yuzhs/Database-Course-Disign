<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æŠ¥å‘Šè¯¦æƒ… - æ™ºæ…§èƒ½æºç®¡ç†</title>
<!--    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">-->
    <style>
        .report-detail-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .report-detail-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }

        .back-link {
            color: #007bff;
            text-decoration: none;
            font-weight: bold;
        }

        .back-link:hover {
            text-decoration: underline;
        }

        .report-content {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            white-space: pre-wrap;
            font-family: 'Consolas', monospace;
            line-height: 1.6;
            font-size: 14px;
            background-color: #f8f9fa;
        }

        .evaluation-section {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }

        .evaluation-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .evaluation-status {
            padding: 8px 16px;
            border-radius: 5px;
            font-weight: bold;
            color: white;
        }

        .status-excellent { background-color: #4CAF50; }
        .status-good { background-color: #2196F3; }
        .status-normal { background-color: #ff9800; }
        .status-poor { background-color: #f44336; }

        .evaluation-score {
            font-size: 24px;
            font-weight: bold;
            color: transparent;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            background-clip: text;
            -webkit-background-clip: text;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .metric-card {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            transition: transform 0.3s;
        }

        .metric-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .metric-card h4 {
            color: #555;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .metric-value {
            font-size: 24px;
            font-weight: bold;
            color: #333;
        }

        .suggestions-list {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 5px;
            border-left: 4px solid #007bff;
            margin-top: 20px;
        }

        .suggestions-list h4 {
            color: #007bff;
            margin-bottom: 15px;
        }

        .suggestions-list ul {
            list-style-type: none;
            padding-left: 0;
        }

        .suggestions-list li {
            padding: 10px 0;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            align-items: flex-start;
        }

        .suggestions-list li:last-child {
            border-bottom: none;
        }

        .suggestions-list li:before {
            content: "âœ… ";
            margin-right: 10px;
        }

        .key-metrics {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 20px;
        }

        .key-metric {
            background-color: #e9ecef;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
            color: #495057;
            display: flex;
            align-items: center;
        }

        .key-metric:before {
            content: "ğŸ“Š ";
            margin-right: 5px;
        }

        .report-meta-info {
            background-color: #e8f4fd;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            border-left: 4px solid #2196F3;
        }

        .report-meta-info p {
            margin: 5px 0;
        }

        .pv-efficiency {
            background-color: #f0fff4;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
            border-left: 4px solid #28a745;
        }

        .data-quality {
            background-color: #fff3e0;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
            border-left: 4px solid #ff9800;
        }

        .report-stats {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
            flex-wrap: wrap;
            gap: 15px;
        }

        .stat-item {
            text-align: center;
            padding: 10px;
            min-width: 150px;
        }

        .stat-value {
            font-size: 20px;
            font-weight: bold;
            color: #333;
            display: block;
        }

        .stat-label {
            font-size: 14px;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="report-detail-container">
        <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
        <div class="header">
            <div class="header-left">
                <h1>æŠ¥å‘Šè¯¦æƒ… - é™æœ¬å¢æ•ˆè¯„ä¼°</h1>
                <p class="welcome">æ¬¢è¿æ‚¨ï¼Œ{{ user.çœŸå®å§“å }}ï¼ˆ{{ user.ç”¨æˆ·è§’è‰² }}ï¼‰</p>
            </div>
            <div class="header-right">
                <div class="current-time" id="current-time"></div>
                <a href="{{ url_for('management_dashboard') }}" class="btn-logout">è¿”å›å¤§å±</a>
                <a href="{{ url_for('logout') }}" class="btn-logout">é€€å‡ºç™»å½•</a>
            </div>
        </div>

        {% if error %}
        <div class="error-message">{{ error }}</div>
        {% endif %}

        {% if report %}
        <!-- æŠ¥å‘ŠåŸºæœ¬ä¿¡æ¯ -->
        <div class="report-meta-info">
            <h3>ğŸ“„ æŠ¥å‘ŠåŸºæœ¬ä¿¡æ¯</h3>
            <div class="report-stats">
                <div class="stat-item">
                    <span class="stat-value">#{{ report.æŠ¥å‘ŠID }}</span>
                    <span class="stat-label">æŠ¥å‘ŠID</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value">{{ report.ç”Ÿæˆæ—¶é—´ }}</span>
                    <span class="stat-label">ç”Ÿæˆæ—¶é—´</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value">{% if report.æŠ¥å‘Šç±»å‹ == 1 %}æœˆåº¦{% else %}å­£åº¦{% endif %}</span>
                    <span class="stat-label">æŠ¥å‘Šç±»å‹</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value">#{{ report.ç”ŸæˆäººID }}</span>
                    <span class="stat-label">ç”Ÿæˆäºº</span>
                </div>
            </div>
        </div>

        <!-- é™æœ¬å¢æ•ˆè¯„ä¼°ç»“æœ -->
        {% if evaluation %}
        <div class="evaluation-section">
            <div class="evaluation-header">
                <h3>ğŸ“ˆ é™æœ¬å¢æ•ˆç›®æ ‡å®Œæˆæƒ…å†µè¯„ä¼°</h3>
                <div>
                    <span class="evaluation-status status-{{ evaluation.status }}">
                        {{ evaluation.status }}
                    </span>
                    <span class="evaluation-score">{{ evaluation.score }}åˆ†</span>
                </div>
            </div>

            <div class="metrics-grid">
                <div class="metric-card">
                    <h4>æ€»èƒ½è€—</h4>
                    <div class="metric-value">{{ evaluation.total_energy_consumption }}</div>
                </div>

                <div class="metric-card">
                    <h4>æ€»æˆæœ¬</h4>
                    <div class="metric-value">ï¿¥{{ evaluation.total_cost }}</div>
                </div>

                <div class="metric-card">
                    <h4>å…‰ä¼æ€»å‘ç”µé‡</h4>
                    <div class="metric-value">{{ evaluation.pv_generation }} kWh</div>
                </div>

                <div class="metric-card">
                    <h4>å…‰ä¼è‡ªç”¨ç”µé‡</h4>
                    <div class="metric-value">{{ evaluation.pv_self_use }} kWh</div>
                </div>

                <div class="metric-card">
                    <h4>å…‰ä¼è‡ªç”¨ç‡</h4>
                    <div class="metric-value">{{ evaluation.pv_utilization_rate }}%</div>
                </div>

                <div class="metric-card">
                    <h4>å•ä½èƒ½è€—æˆæœ¬</h4>
                    <div class="metric-value">ï¿¥{{ evaluation.cost_per_unit }}</div>
                </div>

                <div class="metric-card">
                    <h4>æ€»å‘Šè­¦æ¬¡æ•°</h4>
                    <div class="metric-value">{{ evaluation.alarm_count }}</div>
                </div>

                <div class="metric-card">
                    <h4>{{ evaluation.target_type }}</h4>
                    <div class="metric-value">{{ evaluation.target_description }}</div>
                </div>
            </div>

            <!-- ä¼˜åŒ–å»ºè®® -->
            {% if evaluation.suggestions %}
            <div class="suggestions-list">
                <h4>ğŸ’¡ ä¼˜åŒ–å»ºè®®</h4>
                <ul>
                    {% for suggestion in evaluation.suggestions %}
                    <li>{{ suggestion }}</li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}

            <!-- å…‰ä¼æ•ˆç‡åˆ†æ -->
            {% if evaluation.pv_average_efficiency %}
            <div class="pv-efficiency">
                <h4>ğŸ­ å…‰ä¼æ•ˆç‡åˆ†æ</h4>
                <div class="report-stats">
                    <div class="stat-item">
                        <span class="stat-value">{{ evaluation.pv_average_efficiency }}%</span>
                        <span class="stat-label">å¹³å‡æ•ˆç‡</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value">{{ evaluation.pv_low_efficiency_count }}</span>
                        <span class="stat-label">ä½æ•ˆè®¾å¤‡</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value">{{ evaluation.pv_low_efficiency_ratio }}%</span>
                        <span class="stat-label">ä½æ•ˆå æ¯”</span>
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- æ•°æ®è´¨é‡ -->
            <div class="data-quality">
                <h4>ğŸ“Š æ•°æ®è´¨é‡è¯´æ˜</h4>
                <div class="report-stats">
                    <div class="stat-item">
                        <span class="stat-value">{{ evaluation.energy_records }}</span>
                        <span class="stat-label">èƒ½è€—è®°å½•</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value">{{ evaluation.pv_records }}</span>
                        <span class="stat-label">å…‰ä¼è®°å½•</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value">{{ evaluation.alarm_records }}</span>
                        <span class="stat-label">å‘Šè­¦è®°å½•</span>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- åŸå§‹æŠ¥å‘Šå†…å®¹ -->
        <div class="report-content">
            {{ report.æŠ¥å‘Šå†…å®¹ }}
        </div>

        <!-- è¿”å›æŒ‰é’® -->
        <div style="text-align: center; margin-top: 20px;">
            <a href="{% if report.æŠ¥å‘Šç±»å‹ == 1 %}{{ url_for('management_monthly_reports') }}{% else %}{{ url_for('management_quarterly_reports') }}{% endif %}"
               class="back-link" style="font-size: 16px; padding: 10px 20px;">
                â† è¿”å›æŠ¥å‘Šåˆ—è¡¨
            </a>
        </div>
        {% endif %}
    </div>

    <script>
        // æ›´æ–°æ—¶é—´æ˜¾ç¤º
        function updateTime() {
            const now = new Date();
            const timeStr = now.toLocaleString('zh-CN');
            document.getElementById('current-time').textContent = timeStr;
        }

        // é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œ
        window.onload = function() {
            updateTime();
            setInterval(updateTime, 1000);
        };
    </script>
</body>
</html>